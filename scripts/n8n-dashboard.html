<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FFMATUPA N8N Cloud Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        .status-healthy { background: #27ae60; }
        .status-warning { background: #f39c12; }
        .status-error { background: #e74c3c; }
        .status-unknown { background: #95a5a6; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-value {
            font-weight: bold;
            color: #2c3e50;
        }

        .service-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            background: rgba(0,0,0,0.05);
        }

        .service-name {
            font-weight: bold;
        }

        .service-info {
            font-size: 0.9em;
            color: #666;
        }

        .alert {
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-critical {
            background: rgba(231, 76, 60, 0.1);
            border-color: #e74c3c;
        }

        .alert-error {
            background: rgba(230, 126, 34, 0.1);
            border-color: #e67e22;
        }

        .alert-warning {
            background: rgba(243, 156, 18, 0.1);
            border-color: #f39c12;
        }

        .alert-success {
            background: rgba(39, 174, 96, 0.1);
            border-color: #27ae60;
        }

        .alert-time {
            font-size: 0.8em;
            color: #666;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .button-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .button-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .button-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .log-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }

        .log-error { color: #e74c3c; }
        .log-warning { color: #f39c12; }
        .log-success { color: #27ae60; }
        .log-info { color: #3498db; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            transition: width 0.3s ease;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            position: relative;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
            margin: 10px 0;
        }

        .refresh-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(52, 152, 219, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            display: none;
            z-index: 1000;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #666;
            margin-top: 5px;
        }

        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255,255,255,0.8);
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                üéØ FFMATUPA N8N Cloud Dashboard
                <span class="status-indicator" id="systemStatus"></span>
            </h1>
            <p>Sistema de Monitoramento em Tempo Real - √öltima atualiza√ß√£o: <span id="lastUpdate">Carregando...</span></p>
        </div>

        <!-- Controls -->
        <div class="controls">
            <h3>üîß Controles do Sistema</h3>
            <button class="button" onclick="refreshDashboard()">üîÑ Atualizar</button>
            <button class="button button-success" onclick="activateWorkflow()">‚ñ∂Ô∏è Ativar Workflow</button>
            <button class="button button-warning" onclick="testConnectivity()">üß™ Testar Conectividade</button>
            <button class="button button-danger" onclick="emergencyFallback()">üö® Fallback Emergencial</button>
            <button class="button" onclick="downloadLogs()">üì• Download Logs</button>
            <span id="operationStatus"></span>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- System Overview -->
            <div class="card">
                <h3>üìä Vis√£o Geral do Sistema</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="uptime">--</div>
                        <div class="stat-label">Uptime (min)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="totalChecks">--</div>
                        <div class="stat-label">Verifica√ß√µes</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="errorRate">--%</div>
                        <div class="stat-label">Taxa de Erro</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="avgResponse">--ms</div>
                        <div class="stat-label">Resposta M√©dia</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="systemHealthProgress"></div>
                </div>
            </div>

            <!-- Services Status -->
            <div class="card">
                <h3>üîó Status dos Servi√ßos</h3>
                <div id="servicesStatus">
                    <div class="service-status">
                        <div>
                            <div class="service-name">N8N Primary Workflow</div>
                            <div class="service-info" id="n8nPrimaryInfo">Carregando...</div>
                        </div>
                        <span class="status-indicator" id="n8nPrimaryStatus"></span>
                    </div>
                    <div class="service-status">
                        <div>
                            <div class="service-name">N8N Backup Webhook</div>
                            <div class="service-info" id="n8nBackupInfo">Carregando...</div>
                        </div>
                        <span class="status-indicator" id="n8nBackupStatus"></span>
                    </div>
                    <div class="service-status">
                        <div>
                            <div class="service-name">WAHA WhatsApp API</div>
                            <div class="service-info" id="wahaInfo">Carregando...</div>
                        </div>
                        <span class="status-indicator" id="wahaStatus"></span>
                    </div>
                    <div class="service-status">
                        <div>
                            <div class="service-name">N8N Bridge</div>
                            <div class="service-info" id="bridgeInfo">Carregando...</div>
                        </div>
                        <span class="status-indicator" id="bridgeStatus"></span>
                    </div>
                </div>
            </div>

            <!-- Alerts -->
            <div class="card">
                <h3>üö® Alertas Recentes</h3>
                <div id="alertsContainer">
                    <div class="alert alert-warning">
                        <div><strong>Sistema Inicializando</strong></div>
                        <div class="alert-time">Aguardando dados...</div>
                    </div>
                </div>
            </div>

            <!-- Response Time Chart -->
            <div class="card">
                <h3>üìà Tempo de Resposta</h3>
                <div class="chart-container" id="responseChart">
                    <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                        üìä Gr√°fico ser√° carregado ap√≥s dados estarem dispon√≠veis
                    </div>
                </div>
            </div>

            <!-- Queue Status -->
            <div class="card">
                <h3>üìã Status das Filas</h3>
                <div class="metric">
                    <span>Pendentes:</span>
                    <span class="metric-value" id="queuePending">--</span>
                </div>
                <div class="metric">
                    <span>Processando:</span>
                    <span class="metric-value" id="queueProcessing">--</span>
                </div>
                <div class="metric">
                    <span>Conclu√≠das:</span>
                    <span class="metric-value" id="queueCompleted">--</span>
                </div>
                <div class="metric">
                    <span>Falharam:</span>
                    <span class="metric-value" id="queueFailed">--</span>
                </div>
            </div>

            <!-- System Logs -->
            <div class="card" style="grid-column: 1 / -1;">
                <h3>üìã Logs do Sistema</h3>
                <div class="log-container" id="systemLogs">
                    <div class="log-entry log-info">[INFO] Dashboard inicializado</div>
                    <div class="log-entry log-info">[INFO] Aguardando dados do sistema...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Refresh Indicator -->
    <div class="refresh-indicator" id="refreshIndicator">
        <span class="loading"></span> Atualizando...
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>FFMATUPA Fitness Academy - Sistema N8N Cloud Dashboard v1.0</p>
        <p>Monitoramento Automatizado | Desenvolvido para m√°xima confiabilidade</p>
    </div>

    <script>
        // Global variables
        let dashboardData = {};
        let autoRefreshInterval;
        let responseTimeData = [];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            startAutoRefresh();
        });

        function initializeDashboard() {
            console.log('Inicializando dashboard...');
            refreshDashboard();
        }

        function startAutoRefresh() {
            autoRefreshInterval = setInterval(refreshDashboard, 30000); // 30 segundos
        }

        async function refreshDashboard() {
            showRefreshIndicator();

            try {
                // Simular dados para demonstra√ß√£o
                await generateDemoData();
                updateDashboard();
                addLogEntry('Dashboard atualizado com sucesso', 'success');
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
                addLogEntry(`Erro ao atualizar: ${error.message}`, 'error');
            } finally {
                hideRefreshIndicator();
            }
        }

        async function generateDemoData() {
            // Simular dados do sistema
            const now = new Date();
            const isHealthy = Math.random() > 0.2; // 80% chance de estar saud√°vel

            dashboardData = {
                timestamp: now.toISOString(),
                summary: {
                    totalAlerts: Math.floor(Math.random() * 10),
                    criticalAlerts: Math.floor(Math.random() * 3),
                    unacknowledgedAlerts: Math.floor(Math.random() * 5),
                    recentAlerts: Math.floor(Math.random() * 8)
                },
                metrics: {
                    uptime: Math.floor(Math.random() * 1440), // minutos
                    totalChecks: Math.floor(Math.random() * 1000) + 500,
                    totalFailures: Math.floor(Math.random() * 50),
                    consecutiveFailures: Math.floor(Math.random() * 3),
                    errorRate: (Math.random() * 10).toFixed(2),
                    avgResponseTime: Math.floor(Math.random() * 5000) + 500
                },
                services: {
                    n8nPrimary: {
                        status: isHealthy ? 'healthy' : 'unhealthy',
                        lastCheck: now.toISOString(),
                        failures: Math.floor(Math.random() * 5),
                        responseTime: Math.floor(Math.random() * 3000) + 200
                    },
                    n8nBackup: {
                        status: Math.random() > 0.3 ? 'healthy' : 'unhealthy',
                        lastCheck: now.toISOString(),
                        failures: Math.floor(Math.random() * 3),
                        responseTime: Math.floor(Math.random() * 3000) + 200
                    },
                    waha: {
                        status: Math.random() > 0.1 ? 'healthy' : 'unhealthy',
                        lastCheck: now.toISOString(),
                        failures: Math.floor(Math.random() * 2),
                        responseTime: Math.floor(Math.random() * 1000) + 100
                    },
                    bridge: {
                        status: Math.random() > 0.15 ? 'healthy' : 'unhealthy',
                        lastCheck: now.toISOString(),
                        failures: Math.floor(Math.random() * 3),
                        responseTime: Math.floor(Math.random() * 2000) + 150
                    }
                },
                queues: {
                    pending: Math.floor(Math.random() * 50),
                    processing: Math.floor(Math.random() * 10),
                    completed: Math.floor(Math.random() * 1000) + 100,
                    failed: Math.floor(Math.random() * 20)
                },
                recentAlerts: generateRandomAlerts()
            };

            // Adicionar dados de tempo de resposta
            responseTimeData.push({
                timestamp: now.getTime(),
                responseTime: dashboardData.metrics.avgResponseTime
            });

            // Manter apenas os √∫ltimos 50 pontos
            if (responseTimeData.length > 50) {
                responseTimeData = responseTimeData.slice(-50);
            }
        }

        function generateRandomAlerts() {
            const alertTypes = [
                { type: 'WORKFLOW_DOWN', severity: 'critical', message: 'Workflow N8N Cloud est√° inativo' },
                { type: 'HIGH_ERROR_RATE', severity: 'warning', message: 'Taxa de erro elevada detectada' },
                { type: 'SERVICE_UNAVAILABLE', severity: 'error', message: 'Servi√ßo WAHA indispon√≠vel' },
                { type: 'SLOW_RESPONSE', severity: 'warning', message: 'Tempo de resposta elevado' },
                { type: 'RECOVERY_SUCCESS', severity: 'success', message: 'Sistema recuperado com sucesso' }
            ];

            const alerts = [];
            const alertCount = Math.floor(Math.random() * 5) + 1;

            for (let i = 0; i < alertCount; i++) {
                const alert = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                alerts.push({
                    id: `alert_${Date.now()}_${i}`,
                    type: alert.type,
                    severity: alert.severity,
                    message: alert.message,
                    timestamp: new Date(Date.now() - Math.random() * 3600000).toISOString(),
                    acknowledged: Math.random() > 0.7,
                    resolved: Math.random() > 0.8
                });
            }

            return alerts;
        }

        function updateDashboard() {
            // Atualizar timestamp
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('pt-BR');

            // Atualizar status geral do sistema
            const systemHealthy = Object.values(dashboardData.services).filter(s => s.status === 'healthy').length;
            const totalServices = Object.keys(dashboardData.services).length;
            const healthPercentage = (systemHealthy / totalServices) * 100;

            const systemStatusElement = document.getElementById('systemStatus');
            if (healthPercentage >= 75) {
                systemStatusElement.className = 'status-indicator status-healthy';
            } else if (healthPercentage >= 50) {
                systemStatusElement.className = 'status-indicator status-warning';
            } else {
                systemStatusElement.className = 'status-indicator status-error';
            }

            // Atualizar m√©tricas
            document.getElementById('uptime').textContent = dashboardData.metrics.uptime;
            document.getElementById('totalChecks').textContent = dashboardData.metrics.totalChecks;
            document.getElementById('errorRate').textContent = dashboardData.metrics.errorRate + '%';
            document.getElementById('avgResponse').textContent = dashboardData.metrics.avgResponseTime + 'ms';

            // Atualizar barra de progresso
            document.getElementById('systemHealthProgress').style.width = healthPercentage + '%';

            // Atualizar status dos servi√ßos
            updateServiceStatus('n8nPrimary', 'N8N Primary', dashboardData.services.n8nPrimary);
            updateServiceStatus('n8nBackup', 'N8N Backup', dashboardData.services.n8nBackup);
            updateServiceStatus('waha', 'WAHA', dashboardData.services.waha);
            updateServiceStatus('bridge', 'Bridge', dashboardData.services.bridge);

            // Atualizar alertas
            updateAlerts();

            // Atualizar filas
            document.getElementById('queuePending').textContent = dashboardData.queues.pending;
            document.getElementById('queueProcessing').textContent = dashboardData.queues.processing;
            document.getElementById('queueCompleted').textContent = dashboardData.queues.completed;
            document.getElementById('queueFailed').textContent = dashboardData.queues.failed;

            // Atualizar gr√°fico de tempo de resposta
            updateResponseChart();
        }

        function updateServiceStatus(serviceId, serviceName, serviceData) {
            const statusElement = document.getElementById(serviceId + 'Status');
            const infoElement = document.getElementById(serviceId + 'Info');

            // Atualizar indicador de status
            statusElement.className = `status-indicator status-${serviceData.status === 'healthy' ? 'healthy' : 'error'}`;

            // Atualizar informa√ß√µes
            const lastCheck = new Date(serviceData.lastCheck).toLocaleTimeString('pt-BR');
            infoElement.textContent = `${serviceData.responseTime}ms | ${serviceData.failures} falhas | ${lastCheck}`;
        }

        function updateAlerts() {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';

            if (dashboardData.recentAlerts.length === 0) {
                alertsContainer.innerHTML = '<div class="alert alert-success"><div><strong>Nenhum alerta</strong></div><div class="alert-time">Sistema operando normalmente</div></div>';
                return;
            }

            dashboardData.recentAlerts.forEach(alert => {
                const alertElement = document.createElement('div');
                alertElement.className = `alert alert-${alert.severity}`;

                const statusIcon = alert.resolved ? '‚úÖ' : alert.acknowledged ? 'üëÅÔ∏è' : 'üö®';
                const alertTime = new Date(alert.timestamp).toLocaleString('pt-BR');

                alertElement.innerHTML = `
                    <div><strong>${statusIcon} ${alert.type}</strong></div>
                    <div>${alert.message}</div>
                    <div class="alert-time">${alertTime}</div>
                `;

                alertsContainer.appendChild(alertElement);
            });
        }

        function updateResponseChart() {
            const chartContainer = document.getElementById('responseChart');

            if (responseTimeData.length < 2) {
                chartContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">üìä Coletando dados...</div>';
                return;
            }

            // Gerar gr√°fico simples com CSS
            const maxResponseTime = Math.max(...responseTimeData.map(d => d.responseTime));
            const minResponseTime = Math.min(...responseTimeData.map(d => d.responseTime));

            let chartHTML = '<div style="position: relative; height: 100%; padding: 10px;">';
            chartHTML += '<div style="display: flex; height: 160px; align-items: end; gap: 2px;">';

            responseTimeData.forEach((point, index) => {
                const height = ((point.responseTime - minResponseTime) / (maxResponseTime - minResponseTime)) * 140 + 20;
                const color = point.responseTime > 3000 ? '#e74c3c' : point.responseTime > 1500 ? '#f39c12' : '#27ae60';

                chartHTML += `<div style="flex: 1; background: ${color}; height: ${height}px; border-radius: 2px 2px 0 0; opacity: 0.8;"></div>`;
            });

            chartHTML += '</div>';
            chartHTML += `<div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">Min: ${minResponseTime}ms | Max: ${maxResponseTime}ms</div>`;
            chartHTML += '</div>';

            chartContainer.innerHTML = chartHTML;
        }

        function addLogEntry(message, type = 'info') {
            const logsContainer = document.getElementById('systemLogs');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = document.createElement('div');

            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;

            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;

            // Limitar a 100 entradas de log
            while (logsContainer.children.length > 100) {
                logsContainer.removeChild(logsContainer.firstChild);
            }
        }

        function showRefreshIndicator() {
            document.getElementById('refreshIndicator').style.display = 'block';
        }

        function hideRefreshIndicator() {
            document.getElementById('refreshIndicator').style.display = 'none';
        }

        function showOperationStatus(message, type = 'info') {
            const statusElement = document.getElementById('operationStatus');
            statusElement.textContent = message;
            statusElement.className = `log-${type}`;
            statusElement.style.marginLeft = '10px';

            setTimeout(() => {
                statusElement.textContent = '';
            }, 5000);
        }

        // Fun√ß√µes de controle
        async function activateWorkflow() {
            showOperationStatus('Ativando workflow...', 'info');
            addLogEntry('Tentativa de ativa√ß√£o de workflow iniciada', 'info');

            // Simular opera√ß√£o
            setTimeout(() => {
                const success = Math.random() > 0.3;
                if (success) {
                    showOperationStatus('Workflow ativado com sucesso!', 'success');
                    addLogEntry('Workflow N8N ativado com sucesso', 'success');
                } else {
                    showOperationStatus('Falha na ativa√ß√£o do workflow', 'error');
                    addLogEntry('Falha na ativa√ß√£o do workflow', 'error');
                }
            }, 2000);
        }

        async function testConnectivity() {
            showOperationStatus('Testando conectividade...', 'info');
            addLogEntry('Teste de conectividade iniciado', 'info');

            setTimeout(() => {
                const success = Math.random() > 0.2;
                if (success) {
                    showOperationStatus('Conectividade OK!', 'success');
                    addLogEntry('Teste de conectividade bem-sucedido', 'success');
                } else {
                    showOperationStatus('Problemas de conectividade detectados', 'warning');
                    addLogEntry('Problemas de conectividade detectados', 'warning');
                }
            }, 3000);
        }

        async function emergencyFallback() {
            showOperationStatus('Ativando fallback emergencial...', 'warning');
            addLogEntry('Sistema de fallback emergencial ativado', 'warning');

            setTimeout(() => {
                showOperationStatus('Fallback ativo - opera√ß√£o local', 'success');
                addLogEntry('Sistema operando em modo fallback local', 'info');
            }, 1500);
        }

        function downloadLogs() {
            const logs = Array.from(document.querySelectorAll('.log-entry')).map(entry => entry.textContent).join('\n');
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `n8n-dashboard-logs-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showOperationStatus('Logs baixados com sucesso!', 'success');
        }

        // Cleanup ao fechar a p√°gina
        window.addEventListener('beforeunload', function() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        });
    </script>
</body>
</html>