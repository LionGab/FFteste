{
  "name": "üöÄ FITNESS ACADEMY - DISRUPTIVE WHATSAPP AUTOMATION",
  "nodes": [
    {
      "parameters": {
        "path": "fitness-academy-webhook",
        "httpMethod": "POST",
        "responseMode": "responseNode",
        "options": {
          "noResponseBody": false
        }
      },
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "üéØ Lead Capture Hub",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [100, 300],
      "webhookId": "fitness-academy-lead-capture",
      "notes": "Receives leads from website forms, social media, QR codes, and direct messages"
    },
    {
      "parameters": {
        "jsCode": "// DISRUPTIVE LEAD SCORING AND QUALIFICATION ENGINE\nconst input = $input.first().json;\nconst currentTime = new Date();\nconst leadData = input.body || input;\n\n// Extract lead information from multiple sources\nlet leadSource = 'unknown';\nlet contactInfo = {};\nlet qualificationScore = 0;\nlet urgencyLevel = 'low';\nlet leadIntent = 'unknown';\n\n// Determine lead source and extract data\nif (leadData.source === 'website_form') {\n  leadSource = 'website';\n  contactInfo = {\n    name: leadData.name || '',\n    phone: leadData.phone || '',\n    email: leadData.email || '',\n    interest: leadData.interest || '',\n    message: leadData.message || ''\n  };\n  qualificationScore += 30; // Website leads are pre-qualified\n} else if (leadData.source === 'facebook_ads') {\n  leadSource = 'facebook';\n  contactInfo = {\n    name: leadData.full_name || '',\n    phone: leadData.phone_number || '',\n    email: leadData.email || '',\n    ad_name: leadData.ad_name || '',\n    campaign_name: leadData.campaign_name || ''\n  };\n  qualificationScore += 25;\n} else if (leadData.source === 'instagram') {\n  leadSource = 'instagram';\n  contactInfo = {\n    name: leadData.username || '',\n    phone: leadData.phone || '',\n    dm_content: leadData.message || ''\n  };\n  qualificationScore += 20;\n} else if (leadData.source === 'qr_code') {\n  leadSource = 'qr_scan';\n  contactInfo = {\n    phone: leadData.phone || '',\n    location: leadData.scan_location || '',\n    timestamp: leadData.scan_time || ''\n  };\n  qualificationScore += 40; // QR scans show high intent\n} else if (leadData.source === 'referral') {\n  leadSource = 'referral';\n  contactInfo = {\n    name: leadData.referred_name || '',\n    phone: leadData.referred_phone || '',\n    referrer_name: leadData.referrer_name || '',\n    referrer_phone: leadData.referrer_phone || ''\n  };\n  qualificationScore += 50; // Referrals have highest conversion\n}\n\n// Advanced qualification scoring\nif (contactInfo.phone && contactInfo.phone.length >= 10) qualificationScore += 20;\nif (contactInfo.email && contactInfo.email.includes('@')) qualificationScore += 15;\nif (contactInfo.name && contactInfo.name.length > 2) qualificationScore += 10;\n\n// Intent analysis\nconst intentKeywords = {\n  high: ['quero', 'preciso', 'urgente', 'hoje', 'agora', 'matricula', 'come√ßar', 'iniciar'],\n  medium: ['interesse', 'informa√ß√£o', 'saber', 'conhecer', 'visitar', 'avaliar'],\n  low: ['talvez', 'futuro', 'pensar', 'considerar', 'd√∫vida']\n};\n\nconst messageText = (contactInfo.message || contactInfo.dm_content || '').toLowerCase();\nif (intentKeywords.high.some(word => messageText.includes(word))) {\n  leadIntent = 'high';\n  qualificationScore += 30;\n  urgencyLevel = 'high';\n} else if (intentKeywords.medium.some(word => messageText.includes(word))) {\n  leadIntent = 'medium';\n  qualificationScore += 15;\n  urgencyLevel = 'medium';\n} else if (intentKeywords.low.some(word => messageText.includes(word))) {\n  leadIntent = 'low';\n  qualificationScore += 5;\n}\n\n// Time-based urgency (business hours = higher urgency)\nconst hour = currentTime.getHours();\nif (hour >= 6 && hour <= 22) {\n  qualificationScore += 10;\n  if (urgencyLevel === 'low') urgencyLevel = 'medium';\n}\n\n// Determine lead temperature\nlet leadTemperature = 'cold';\nif (qualificationScore >= 80) leadTemperature = 'hot';\nelse if (qualificationScore >= 50) leadTemperature = 'warm';\n\n// Generate personalized welcome message\nlet welcomeMessage = '';\nconst firstName = (contactInfo.name || '').split(' ')[0] || 'amigo(a)';\n\nif (leadTemperature === 'hot') {\n  welcomeMessage = `üî• Oi ${firstName}! PERFEITO timing!\\n\\nüí™ Vi que voc√™ tem INTERESSE REAL em transformar seu corpo!\\n\\nüéØ Vou te fazer uma PROPOSTA IRRESIST√çVEL:\\n\\n‚úÖ Avalia√ß√£o f√≠sica GRATUITA\\n‚úÖ Aula experimental SEM COMPROMISSO\\n‚úÖ Plano personalizado na hora\\n\\nüöÄ B√îNUS: Se decidir hoje, ganha 2 SEMANAS GR√ÅTIS!\\n\\nQual seu objetivo principal? Responde a√≠! üëá`;\n} else if (leadTemperature === 'warm') {\n  welcomeMessage = `üëã Oi ${firstName}! Bem-vindo(a)!\\n\\nüèãÔ∏è Vi seu interesse na nossa academia! Que legal!\\n\\nüéÅ Preparei algo ESPECIAL pra voc√™:\\n\\n‚úÖ Tour completo nas instala√ß√µes\\n‚úÖ Conversa com personal trainer\\n‚úÖ Avalia√ß√£o f√≠sica gratuita\\n\\nConta pra mim: qual seu maior desafio fitness? üí™`;\n} else {\n  welcomeMessage = `üòä Ol√°! Obrigado pelo contato!\\n\\nüèÉ‚Äç‚ôÄÔ∏è Que bom ter voc√™ aqui! Nossa academia vai te surpreender!\\n\\nüìã MENU R√ÅPIDO:\\n1Ô∏è‚É£ *PLANOS* - Ver pre√ßos\\n2Ô∏è‚É£ *HOR√ÅRIOS* - Funcionamento\\n3Ô∏è‚É£ *AGENDAR* - Visita gratuita\\n4Ô∏è‚É£ *MODALIDADES* - Atividades\\n\\nO que te interessa mais? ü§î`;\n}\n\n// Clean phone number\nconst cleanPhone = (contactInfo.phone || '').replace(/[^0-9]/g, '');\n\nreturn [{\n  json: {\n    // Original data\n    originalData: leadData,\n    \n    // Processed lead information\n    leadId: `LEAD_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    source: leadSource,\n    name: contactInfo.name || 'Lead An√¥nimo',\n    phone: cleanPhone,\n    email: contactInfo.email || '',\n    \n    // Qualification data\n    qualificationScore,\n    leadTemperature,\n    leadIntent,\n    urgencyLevel,\n    \n    // Communication\n    welcomeMessage,\n    \n    // Timestamps\n    capturedAt: currentTime.toISOString(),\n    timezone: 'America/Sao_Paulo',\n    \n    // Workflow control\n    shouldSendImmediate: leadTemperature === 'hot',\n    followUpSequence: leadTemperature,\n    \n    // Analytics\n    expectedConversionRate: leadTemperature === 'hot' ? 0.4 : leadTemperature === 'warm' ? 0.25 : 0.15,\n    estimatedValue: leadTemperature === 'hot' ? 1200 : leadTemperature === 'warm' ? 800 : 400\n  }\n}];"
      },
      "id": "b2c3d4e5-f6g7-8901-bcde-f23456789012",
      "name": "üß† AI Lead Qualification Engine",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [340, 300],
      "notes": "Advanced AI-powered lead scoring with behavioral analysis and intent detection"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "zbenzap-sniper@stellar-verve-457002-p2.iam.gserviceaccount.com",
        "operation": "appendOrUpdate",
        "documentId": "{{ $vars.GOOGLE_SHEETS_LEADS_ID }}",
        "sheetName": "Leads_Dashboard",
        "columnToMatchOn": "A",
        "valueToMatchOn": "={{ $json.leadId }}",
        "valuesToSend": {
          "specifyColumns": "defineBelow",
          "columnsToSend": {
            "A": "={{ $json.leadId }}",
            "B": "={{ $json.capturedAt }}",
            "C": "={{ $json.name }}",
            "D": "={{ $json.phone }}",
            "E": "={{ $json.email }}",
            "F": "={{ $json.source }}",
            "G": "={{ $json.qualificationScore }}",
            "H": "={{ $json.leadTemperature }}",
            "I": "={{ $json.leadIntent }}",
            "J": "={{ $json.urgencyLevel }}",
            "K": "={{ $json.expectedConversionRate }}",
            "L": "={{ $json.estimatedValue }}",
            "M": "CAPTURED",
            "N": "Aguardando primeiro contato",
            "O": "={{ new Date().toISOString() }}"
          }
        }
      },
      "id": "c3d4e5f6-g7h8-9012-cdef-345678901234",
      "name": "üìä Log to Analytics Dashboard",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [580, 200],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets Fitness Academy"
        }
      },
      "notes": "Real-time lead tracking in Google Sheets with comprehensive analytics"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.phone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isNotEmpty"
              }
            },
            {
              "leftValue": "={{ $json.phone.length }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "gte"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "d4e5f6g7-h8i9-0123-def0-456789012345",
      "name": "‚úÖ Validate Contact Info",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2,
      "position": [580, 400],
      "notes": "Ensures lead has valid phone number before WhatsApp outreach"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.shouldSendImmediate }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ]
        }
      },
      "id": "e5f6g7h8-i9j0-1234-ef01-567890123456",
      "name": "üî• Hot Lead Filter",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [820, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "phoneNumberId": "{{ $vars.WHATSAPP_PHONE_ID }}",
        "recipientPhoneNumber": "55{{ $json.phone }}",
        "messageType": "interactive",
        "interactiveMessageType": "button",
        "bodyText": "{{ $json.welcomeMessage }}",
        "buttonParameters": {
          "values": [
            {
              "text": "üéØ QUERO CONHECER!",
              "id": "hot_lead_interested"
            },
            {
              "text": "üìû FALAR COM CONSULTOR",
              "id": "hot_lead_consultant"
            },
            {
              "text": "üìÖ AGENDAR VISITA",
              "id": "hot_lead_schedule"
            }
          ]
        },
        "footerText": "Academia Fitness Pro - Transforme seu corpo hoje!"
      },
      "id": "f6g7h8i9-j0k1-2345-f012-678901234567",
      "name": "‚ö° Instant Hot Lead Response",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [1060, 200],
      "credentials": {
        "whatsAppApi": {
          "id": "whatsapp-business-credentials",
          "name": "WhatsApp Business API"
        }
      },
      "notes": "Immediate interactive response for high-intent leads"
    },
    {
      "parameters": {
        "amount": 180,
        "unit": "seconds"
      },
      "id": "g7h8i9j0-k1l2-3456-0123-789012345678",
      "name": "‚è∞ Smart Timing Buffer",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [820, 500],
      "notes": "Strategic delay for warm/cold leads - optimal response timing"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "phoneNumberId": "{{ $vars.WHATSAPP_PHONE_ID }}",
        "recipientPhoneNumber": "55{{ $json.phone }}",
        "messageType": "interactive",
        "interactiveMessageType": "list",
        "bodyText": "{{ $json.welcomeMessage }}",
        "listParameters": {
          "buttonText": "üìã ESCOLHER OP√á√ÉO",
          "title": "Como posso ajudar?",
          "sections": [
            {
              "title": "üéØ INFORMA√á√ïES",
              "rows": [
                {
                  "id": "info_plans",
                  "title": "üí∞ Planos e Pre√ßos",
                  "description": "Conhe√ßa nossos planos especiais"
                },
                {
                  "id": "info_schedule",
                  "title": "üïê Hor√°rios",
                  "description": "Funcionamento e aulas"
                },
                {
                  "id": "info_activities",
                  "title": "üèãÔ∏è Modalidades",
                  "description": "Todas as atividades dispon√≠veis"
                }
              ]
            },
            {
              "title": "üöÄ A√á√ÉO IMEDIATA",
              "rows": [
                {
                  "id": "action_visit",
                  "title": "üìÖ Agendar Visita",
                  "description": "Tour gratuito + avalia√ß√£o"
                },
                {
                  "id": "action_trial",
                  "title": "üéÅ Aula Experimental",
                  "description": "Treino gratuito hoje"
                },
                {
                  "id": "action_consultant",
                  "title": "üë®‚Äçüíº Falar com Consultor",
                  "description": "Atendimento personalizado"
                }
              ]
            }
          ]
        },
        "footerText": "Resposta em menos de 2 minutos ‚ö°"
      },
      "id": "h8i9j0k1-l2m3-4567-1234-890123456789",
      "name": "üì± Interactive Menu Response",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [1060, 500],
      "credentials": {
        "whatsAppApi": {
          "id": "whatsapp-business-credentials",
          "name": "WhatsApp Business API"
        }
      },
      "notes": "Smart interactive menu for warm/cold leads with multiple engagement options"
    },
    {
      "parameters": {
        "path": "whatsapp-responses",
        "httpMethod": "POST",
        "responseMode": "responseNode",
        "options": {
          "noResponseBody": false
        }
      },
      "id": "i9j0k1l2-m3n4-5678-2345-901234567890",
      "name": "üí¨ WhatsApp Response Handler",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [100, 800],
      "webhookId": "whatsapp-responses",
      "notes": "Handles all incoming WhatsApp messages and interactions"
    },
    {
      "parameters": {
        "jsCode": "// ADVANCED AI RESPONSE PROCESSOR WITH SENTIMENT ANALYSIS\nconst webhookData = $input.first().json;\nconst messages = webhookData.entry?.[0]?.changes?.[0]?.value?.messages || [];\nconst contacts = webhookData.entry?.[0]?.changes?.[0]?.value?.contacts || [];\n\nif (messages.length === 0) {\n  return [{ json: { no_messages: true } }];\n}\n\nconst items = [];\n\nfor (const message of messages) {\n  const contact = contacts.find(c => c.wa_id === message.from) || {};\n  const messageText = (message.text?.body || '').toLowerCase();\n  const messageType = message.type;\n  \n  // Enhanced Intent Recognition with AI\n  let intent = 'unknown';\n  let confidence = 0;\n  let sentiment = 'neutral';\n  let urgency = 'normal';\n  let suggestedResponse = '';\n  let actionRequired = 'auto_respond';\n  let leadScore = 0;\n  \n  // Sentiment Analysis Keywords\n  const positiveWords = ['√≥timo', 'excelente', 'perfeito', 'adorei', 'incr√≠vel', 'maravilhoso', 'sim', 'quero', 'interessado'];\n  const negativeWords = ['n√£o', 'nao', 'ruim', 'caro', 'longe', 'dif√≠cil', 'complicado', 'problema'];\n  const urgentWords = ['urgente', 'hoje', 'agora', 'imediato', 'r√°pido', 'pressa'];\n  \n  // Calculate sentiment\n  const positiveCount = positiveWords.filter(word => messageText.includes(word)).length;\n  const negativeCount = negativeWords.filter(word => messageText.includes(word)).length;\n  const urgentCount = urgentWords.filter(word => messageText.includes(word)).length;\n  \n  if (positiveCount > negativeCount) {\n    sentiment = 'positive';\n    leadScore += 20;\n  } else if (negativeCount > positiveCount) {\n    sentiment = 'negative';\n    leadScore -= 10;\n  }\n  \n  if (urgentCount > 0) {\n    urgency = 'high';\n    leadScore += 15;\n  }\n  \n  // Advanced Intent Detection\n  if (/(quero|interessado|me inscrevo|vou come√ßar|quero come√ßar)/i.test(messageText)) {\n    intent = 'ready_to_join';\n    confidence = 0.95;\n    leadScore += 50;\n    actionRequired = 'schedule_immediate';\n    suggestedResponse = `üéâ SENSACIONAL! Que energia boa!\\n\\nüöÄ Vou agendar sua avalia√ß√£o HOJE mesmo!\\n\\nEscolha seu hor√°rio preferido:\\n\\n‚è∞ HOJE:\\n‚Ä¢ 14h00 - Dispon√≠vel\\n‚Ä¢ 16h30 - Dispon√≠vel\\n‚Ä¢ 19h00 - Dispon√≠vel\\n\\nüìç Academia Fitness Pro\\nRua Principal, 123\\n\\nüí™ Prepare-se para TRANSFORMAR sua vida!\\n\\nQual hor√°rio √© perfeito pra voc√™?`;\n  } else if (/(pre√ßo|valor|plano|mensalidade|quanto custa)/i.test(messageText)) {\n    intent = 'pricing_inquiry';\n    confidence = 0.9;\n    leadScore += 30;\n    suggestedResponse = `üí∞ PLANOS ESPECIAIS - SETEMBRO 2024\\n\\nüî• SUPER PROMO√á√ÉO:\\n\\nü•á PLANO PREMIUM\\n‚Ä¢ R$ 89,90/m√™s (era R$ 129,90)\\n‚Ä¢ TODAS as modalidades\\n‚Ä¢ Personal trainer 2x/m√™s\\n‚Ä¢ Avalia√ß√£o mensal\\n\\nü•à PLANO B√ÅSICO\\n‚Ä¢ R$ 59,90/m√™s (era R$ 79,90)\\n‚Ä¢ Muscula√ß√£o + 1 modalidade\\n‚Ä¢ Avalia√ß√£o f√≠sica\\n\\nüéÅ B√îNUS HOJE:\\n‚Ä¢ Matr√≠cula GR√ÅTIS (economia R$ 150)\\n‚Ä¢ 1 semana gr√°tis\\n‚Ä¢ Kit academia de brinde\\n\\n‚è∞ OFERTA V√ÅLIDA AT√â AMANH√É!\\n\\nQual plano faz mais sentido pra voc√™?`;\n  } else if (/(agendar|marcar|visita|conhecer|ver|tour)/i.test(messageText)) {\n    intent = 'schedule_visit';\n    confidence = 0.88;\n    leadScore += 35;\n    suggestedResponse = `üìÖ PERFEITO! Vou agendar sua visita VIP!\\n\\nüéØ O QUE VOC√ä VAI GANHAR:\\n\\n‚úÖ Tour completo (15 min)\\n‚úÖ Avalia√ß√£o f√≠sica gratuita\\n‚úÖ Plano personalizado\\n‚úÖ Aula experimental\\n‚úÖ Consultoria nutricional\\n\\nüìã HOR√ÅRIOS HOJE:\\n\\nüåÖ MANH√É: 8h | 10h\\nüåû TARDE: 14h | 16h\\nüåô NOITE: 18h | 20h\\n\\nüíé B√îNUS VISITA:\\nSe decidir hoje = 2 SEMANAS GR√ÅTIS!\\n\\nQue hor√°rio funciona melhor?`;\n  } else if (/(hor√°rio|horario|funciona|abre|fecha|quando)/i.test(messageText)) {\n    intent = 'schedule_info';\n    confidence = 0.85;\n    leadScore += 10;\n    suggestedResponse = `üïê HOR√ÅRIOS DE FUNCIONAMENTO\\n\\nüìÖ SEGUNDA A SEXTA:\\n‚Ä¢ Manh√£: 06h00 √†s 12h00\\n‚Ä¢ Tarde: 13h30 √†s 23h00\\n\\nüìÖ S√ÅBADOS:\\n‚Ä¢ 08h00 √†s 18h00\\n\\nüìÖ DOMINGOS:\\n‚Ä¢ 08h00 √†s 16h00\\n\\nüî• HOR√ÅRIOS DE PICO (mais movimento):\\n‚Ä¢ 07h-09h | 18h-21h\\n\\nüòå HOR√ÅRIOS TRANQUILOS:\\n‚Ä¢ 09h-17h | 21h-23h\\n\\nüí™ Qual per√≠odo voc√™ prefere treinar?\\n\\nüéÅ Quer agendar um hor√°rio pra conhecer?`;\n  } else if (/(modalidade|atividade|treino|aula|exerc√≠cio)/i.test(messageText)) {\n    intent = 'activities_info';\n    confidence = 0.82;\n    leadScore += 15;\n    suggestedResponse = `üèãÔ∏è MODALIDADES DISPON√çVEIS\\n\\nüí™ MUSCULA√á√ÉO\\n‚Ä¢ Equipamentos modernos\\n‚Ä¢ Acompanhamento profissional\\n\\nüßò‚Äç‚ôÄÔ∏è AULAS COLETIVAS:\\n‚Ä¢ Zumba (Seg/Qua/Sex - 19h)\\n‚Ä¢ Yoga (Ter/Qui - 19h)\\n‚Ä¢ Pilates (S√°b - 9h)\\n‚Ä¢ Spinning (Seg/Qua/Sex - 7h)\\n\\nü•ä LUTAS:\\n‚Ä¢ Boxe (Ter/Qui - 20h)\\n‚Ä¢ Muay Thai (Seg/Qua/Sex - 20h)\\n\\nüèä‚Äç‚ôÇÔ∏è AQU√ÅTICOS:\\n‚Ä¢ Hidrogin√°stica (Ter/Qui - 16h)\\n‚Ä¢ Nata√ß√£o (livre)\\n\\nüéØ Qual atividade desperta seu interesse?\\n\\nüéÅ Aula experimental GRATUITA!`;\n  } else if (/(n√£o|nao|sem interesse|parar|cancelar)/i.test(messageText)) {\n    intent = 'not_interested';\n    confidence = 0.9;\n    actionRequired = 'human_intervention';\n    suggestedResponse = `üòä Tudo bem! Respeitamos sua decis√£o.\\n\\nü§ù Se um dia mudar de ideia, estaremos aqui!\\n\\nüíö Desejamos muito sucesso nos seus objetivos!\\n\\nüì± Este chat ficar√° sempre dispon√≠vel pra voc√™.`;\n  } else if (/(emerg√™ncia|problema|reclama√ß√£o|urgente)/i.test(messageText)) {\n    intent = 'urgent_issue';\n    confidence = 0.95;\n    urgency = 'critical';\n    actionRequired = 'immediate_human';\n    suggestedResponse = `‚ö†Ô∏è Entendi que √© urgente!\\n\\nüë®‚Äçüíº Vou conectar voc√™ AGORA com nosso gerente:\\n\\nüìû WhatsApp Direto: (65) 9999-8888\\nüìû Telefone: (65) 3333-4444\\n\\n‚è∞ Resposta em menos de 5 minutos!`;\n  } else {\n    // Default intelligent response with personalization\n    const firstName = contact.profile?.name?.split(' ')[0] || 'amigo(a)';\n    suggestedResponse = `Oi ${firstName}! üòä\\n\\nü§ñ Sou a assistente da Academia Fitness Pro!\\n\\nüìã MENU R√ÅPIDO:\\n\\nüí∞ Digite *PLANOS* - Pre√ßos especiais\\nüìÖ Digite *AGENDAR* - Visita gratuita\\nüèãÔ∏è Digite *MODALIDADES* - Atividades\\nüïê Digite *HOR√ÅRIOS* - Funcionamento\\nüë®‚Äçüíº Digite *CONSULTOR* - Falar com humano\\n\\nOu me conte: qual seu objetivo fitness? üí™`;\n  }\n  \n  // Personalization based on message history (simulate)\n  const isReturningLead = messageText.includes('voltando') || messageText.includes('de volta');\n  if (isReturningLead) {\n    leadScore += 25;\n    suggestedResponse = `üîÑ Que bom ter voc√™ de volta!\\n\\n` + suggestedResponse;\n  }\n  \n  items.push({\n    json: {\n      phone: message.from,\n      name: contact.profile?.name || 'Lead',\n      messageReceived: message.text?.body || '',\n      messageType,\n      intent,\n      confidence,\n      sentiment,\n      urgency,\n      leadScore,\n      suggestedResponse,\n      actionRequired,\n      messageId: message.id,\n      timestamp: new Date().toISOString(),\n      \n      // Advanced analytics\n      wordCount: messageText.split(' ').length,\n      hasEmojis: /[\\u{1F600}-\\u{1F6FF}]/u.test(message.text?.body || ''),\n      responseTime: 'immediate',\n      \n      // Business intelligence\n      expectedConversion: intent === 'ready_to_join' ? 0.8 : intent === 'schedule_visit' ? 0.6 : 0.3,\n      estimatedValue: intent === 'ready_to_join' ? 1200 : intent === 'schedule_visit' ? 800 : 400,\n      nextBestAction: actionRequired\n    }\n  });\n}\n\nreturn items;"
      },
      "id": "j0k1l2m3-n4o5-6789-3456-012345678901",
      "name": "ü§ñ AI Response Intelligence",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [340, 800],
      "notes": "Advanced AI with sentiment analysis, intent detection, and personalized responses"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "zbenzap-sniper@stellar-verve-457002-p2.iam.gserviceaccount.com",
        "operation": "appendOrUpdate",
        "documentId": "{{ $vars.GOOGLE_SHEETS_LEADS_ID }}",
        "sheetName": "Conversations_Analytics",
        "columnToMatchOn": "A",
        "valueToMatchOn": "={{ $json.phone }}",
        "valuesToSend": {
          "specifyColumns": "defineBelow",
          "columnsToSend": {
            "A": "={{ $json.phone }}",
            "B": "={{ $json.name }}",
            "C": "={{ $json.timestamp }}",
            "D": "={{ $json.messageReceived }}",
            "E": "={{ $json.intent }}",
            "F": "={{ $json.confidence }}",
            "G": "={{ $json.sentiment }}",
            "H": "={{ $json.urgency }}",
            "I": "={{ $json.leadScore }}",
            "J": "={{ $json.actionRequired }}",
            "K": "={{ $json.expectedConversion }}",
            "L": "={{ $json.estimatedValue }}",
            "M": "ANALYZED",
            "N": "{{ new Date().toISOString() }}"
          }
        }
      },
      "id": "k1l2m3n4-o5p6-7890-4567-123456789012",
      "name": "üìà Conversation Analytics",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [580, 700],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets Fitness Academy"
        }
      },
      "notes": "Real-time conversation analytics with AI insights"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.actionRequired }}",
              "rightValue": "auto_respond",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ]
        }
      },
      "id": "l2m3n4o5-p6q7-8901-5678-234567890123",
      "name": "ü§ñ Auto Response Filter",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [580, 900]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "phoneNumberId": "{{ $vars.WHATSAPP_PHONE_ID }}",
        "recipientPhoneNumber": "{{ $json.phone }}",
        "messageType": "text",
        "textBody": "{{ $json.suggestedResponse }}"
      },
      "id": "m3n4o5p6-q7r8-9012-6789-345678901234",
      "name": "üí¨ AI Auto Response",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [820, 900],
      "credentials": {
        "whatsAppApi": {
          "id": "whatsapp-business-credentials",
          "name": "WhatsApp Business API"
        }
      },
      "notes": "Sends AI-generated personalized responses automatically"
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "hour": 9,
              "minute": 0
            }
          ]
        }
      },
      "id": "n4o5p6q7-r8s9-0123-7890-456789012345",
      "name": "‚è∞ Daily Follow-up Trigger",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [100, 1200],
      "notes": "Triggers daily follow-up sequences for leads"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "zbenzap-sniper@stellar-verve-457002-p2.iam.gserviceaccount.com",
        "operation": "read",
        "documentId": "{{ $vars.GOOGLE_SHEETS_LEADS_ID }}",
        "sheetName": "Leads_Dashboard",
        "range": "A:O",
        "options": {
          "firstLineHeaders": true
        }
      },
      "id": "o5p6q7r8-s9t0-1234-8901-567890123456",
      "name": "üìã Get Leads for Follow-up",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [340, 1200],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets Fitness Academy"
        }
      },
      "notes": "Retrieves leads that need follow-up"
    },
    {
      "parameters": {
        "jsCode": "// BEHAVIORAL FOLLOW-UP SEQUENCING ENGINE\nconst items = [];\nconst now = new Date();\nconst leads = $input.all();\n\nfor (const leadItem of leads) {\n  const lead = leadItem.json;\n  \n  // Skip if no phone or status is converted\n  if (!lead.phone || lead.status === 'CONVERTED') continue;\n  \n  const capturedDate = new Date(lead.capturedAt || lead.timestamp);\n  const hoursSinceCapture = (now - capturedDate) / (1000 * 60 * 60);\n  const daysSinceCapture = Math.floor(hoursSinceCapture / 24);\n  \n  let shouldFollowUp = false;\n  let followUpMessage = '';\n  let followUpType = '';\n  let urgencyLevel = 'normal';\n  \n  // Behavioral Follow-up Logic\n  if (lead.leadTemperature === 'hot' && hoursSinceCapture >= 4 && hoursSinceCapture <= 24) {\n    shouldFollowUp = true;\n    followUpType = 'hot_lead_4h';\n    urgencyLevel = 'high';\n    followUpMessage = `üî• Oi ${lead.name.split(' ')[0]}!\\n\\nVi que voc√™ demonstrou INTERESSE REAL na academia mais cedo!\\n\\n‚ö° OFERTA REL√ÇMPAGO - PR√ìXIMAS 2 HORAS:\\n\\nüéÅ MATR√çCULA + 1 M√äS GR√ÅTIS\\nüéÅ Kit academia completo\\nüéÅ Avalia√ß√£o f√≠sica premium\\n\\nüí∞ ECONOMIA TOTAL: R$ 387!\\n\\n‚è∞ Oferta v√°lida AT√â 21h hoje!\\n\\nVem garantir sua vaga! Responde SIM! üí™`;\n  } else if (lead.leadTemperature === 'warm' && daysSinceCapture === 1) {\n    shouldFollowUp = true;\n    followUpType = 'warm_lead_1d';\n    followUpMessage = `üòä Oi ${lead.name.split(' ')[0]}! Tudo bem?\\n\\nüí≠ Ainda pensando sobre entrar em forma?\\n\\nüéØ Que tal esclarecer algumas d√∫vidas? Preparei um GUIA EXCLUSIVO pra voc√™:\\n\\nüì± Link: academia.fitness/guia-${lead.leadId}\\n\\n‚úÖ Resultados reais de alunos\\n‚úÖ Planos detalhados\\n‚úÖ Metodologia exclusiva\\n\\nüí¨ E se tiver qualquer pergunta, √© s√≥ responder aqui!\\n\\nQual sua maior d√∫vida sobre academia? ü§î`;\n  } else if (lead.leadTemperature === 'cold' && daysSinceCapture === 3) {\n    shouldFollowUp = true;\n    followUpType = 'cold_lead_3d';\n    followUpMessage = `üëã Oi ${lead.name.split(' ')[0]}!\\n\\nüèÉ‚Äç‚ôÄÔ∏è Que tal come√ßar sua transforma√ß√£o ainda esta semana?\\n\\nüì∏ Olha s√≥ estes RESULTADOS REAIS dos nossos alunos:\\n\\nüí™ Maria - perdeu 12kg em 3 meses\\nüí™ Jo√£o - ganhou 8kg de m√∫sculo\\nüí™ Ana - eliminou 15cm da cintura\\n\\nüéÅ PROMO√á√ÉO ESPECIAL:\\n‚Ä¢ Avalia√ß√£o gratuita\\n‚Ä¢ 1 semana experimental\\n‚Ä¢ Plano personalizado\\n\\nQuer ser o pr√≥ximo caso de sucesso? üöÄ`;\n  } else if (daysSinceCapture === 7) {\n    shouldFollowUp = true;\n    followUpType = 'weekly_nurture';\n    followUpMessage = `üí™ Oi ${lead.name.split(' ')[0]}!\\n\\nüóìÔ∏è Uma semana se passou... Como andam seus objetivos de sa√∫de?\\n\\nüí° DICA SEMANAL:\\n\\\"O melhor treino √© aquele que voc√™ faz de forma consistente!\\\"\\n\\nüèÜ DESAFIO DA SEMANA:\\n‚Ä¢ 30 minutos de caminhada por dia\\n‚Ä¢ 2 litros de √°gua\\n‚Ä¢ 8 horas de sono\\n\\nü§ù E que tal ter ajuda profissional para acelerar seus resultados?\\n\\nQuer agendar uma conversa? √â s√≥ dizer OI! üòä`;\n  } else if (daysSinceCapture === 30) {\n    shouldFollowUp = true;\n    followUpType = 'monthly_reactivation';\n    urgencyLevel = 'high';\n    followUpMessage = `üéØ ${lead.name.split(' ')[0]}, ainda lembra de mim?\\n\\nüìÖ Faz 1 m√™s que voc√™ demonstrou interesse em cuidar da sua sa√∫de...\\n\\n‚ùì O que mudou nesse tempo?\\n‚ùì Seus objetivos continuam os mesmos?\\n‚ùì Que tal uma NOVA OPORTUNIDADE?\\n\\nüöÄ OFERTA ESPECIAL - S√ì PRA VOC√ä:\\n\\nüéÅ 2 MESES pelo pre√ßo de 1\\nüéÅ Personal trainer incluso\\nüéÅ Acompanhamento nutricional\\n\\nüíù Porque sua sa√∫de n√£o pode esperar mais!\\n\\nVamos conversar? Digite QUERO!`;\n  }\n  \n  if (shouldFollowUp) {\n    items.push({\n      json: {\n        ...lead,\n        followUpMessage,\n        followUpType,\n        urgencyLevel,\n        daysSinceCapture,\n        hoursSinceCapture: Math.round(hoursSinceCapture),\n        followUpTimestamp: now.toISOString(),\n        expectedResponse: followUpType.includes('hot') ? 0.4 : followUpType.includes('warm') ? 0.25 : 0.15\n      }\n    });\n  }\n}\n\n// Sort by urgency (high first)\nreturn items.sort((a, b) => {\n  if (a.json.urgencyLevel === 'high' && b.json.urgencyLevel !== 'high') return -1;\n  if (b.json.urgencyLevel === 'high' && a.json.urgencyLevel !== 'high') return 1;\n  return 0;\n});"
      },
      "id": "p6q7r8s9-t0u1-2345-9012-678901234567",
      "name": "üéØ Behavioral Follow-up Engine",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [580, 1200],
      "notes": "AI-powered behavioral triggers based on lead engagement patterns"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "phoneNumberId": "{{ $vars.WHATSAPP_PHONE_ID }}",
        "recipientPhoneNumber": "55{{ $json.phone }}",
        "messageType": "text",
        "textBody": "{{ $json.followUpMessage }}"
      },
      "id": "q7r8s9t0-u1v2-3456-0123-789012345678",
      "name": "üì§ Send Follow-up Messages",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [820, 1200],
      "credentials": {
        "whatsAppApi": {
          "id": "whatsapp-business-credentials",
          "name": "WhatsApp Business API"
        }
      },
      "notes": "Sends personalized follow-up messages based on behavioral triggers"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "zbenzap-sniper@stellar-verve-457002-p2.iam.gserviceaccount.com",
        "operation": "appendOrUpdate",
        "documentId": "{{ $vars.GOOGLE_SHEETS_LEADS_ID }}",
        "sheetName": "Follow_Up_Analytics",
        "columnToMatchOn": "A",
        "valueToMatchOn": "{{ $json.leadId }}_{{ $json.followUpType }}",
        "valuesToSend": {
          "specifyColumns": "defineBelow",
          "columnsToSend": {
            "A": "{{ $json.leadId }}_{{ $json.followUpType }}",
            "B": "{{ $json.leadId }}",
            "C": "{{ $json.phone }}",
            "D": "{{ $json.name }}",
            "E": "{{ $json.followUpType }}",
            "F": "{{ $json.daysSinceCapture }}",
            "G": "{{ $json.urgencyLevel }}",
            "H": "{{ $json.expectedResponse }}",
            "I": "SENT",
            "J": "{{ $json.followUpTimestamp }}",
            "K": "Aguardando resposta",
            "L": "{{ new Date().toISOString() }}"
          }
        }
      },
      "id": "r8s9t0u1-v2w3-4567-1234-890123456789",
      "name": "üìä Log Follow-up Analytics",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1060, 1200],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets Fitness Academy"
        }
      },
      "notes": "Tracks follow-up performance and conversion rates"
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "hour": 18,
              "minute": 0
            }
          ]
        }
      },
      "id": "s9t0u1v2-w3x4-5678-2345-901234567890",
      "name": "üìà Daily ROI Analytics",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [100, 1500],
      "notes": "Daily ROI calculation and performance optimization"
    },
    {
      "parameters": {
        "jsCode": "// COMPREHENSIVE ROI AND PERFORMANCE ANALYTICS ENGINE\nconst now = new Date();\nconst yesterday = new Date(now - 24 * 60 * 60 * 1000);\nconst thisWeek = new Date(now - 7 * 24 * 60 * 60 * 1000);\nconst thisMonth = new Date(now - 30 * 24 * 60 * 60 * 1000);\n\n// Simulated data - in production, this would fetch from Google Sheets\nconst analytics = {\n  daily: {\n    leads_captured: Math.floor(Math.random() * 25) + 15,\n    messages_sent: Math.floor(Math.random() * 100) + 50,\n    responses_received: Math.floor(Math.random() * 40) + 20,\n    visits_scheduled: Math.floor(Math.random() * 8) + 3,\n    conversions: Math.floor(Math.random() * 3) + 1,\n    revenue_generated: (Math.floor(Math.random() * 3) + 1) * 150 // conversions * average_plan\n  },\n  weekly: {\n    leads_captured: Math.floor(Math.random() * 150) + 100,\n    messages_sent: Math.floor(Math.random() * 600) + 400,\n    responses_received: Math.floor(Math.random() * 250) + 150,\n    visits_scheduled: Math.floor(Math.random() * 50) + 25,\n    conversions: Math.floor(Math.random() * 20) + 10,\n    revenue_generated: (Math.floor(Math.random() * 20) + 10) * 150\n  },\n  monthly: {\n    leads_captured: Math.floor(Math.random() * 500) + 400,\n    messages_sent: Math.floor(Math.random() * 2000) + 1500,\n    responses_received: Math.floor(Math.random() * 800) + 600,\n    visits_scheduled: Math.floor(Math.random() * 150) + 100,\n    conversions: Math.floor(Math.random() * 60) + 40,\n    revenue_generated: (Math.floor(Math.random() * 60) + 40) * 150\n  }\n};\n\n// Calculate key metrics\nconst metrics = {};\n\nfor (const period of ['daily', 'weekly', 'monthly']) {\n  const data = analytics[period];\n  \n  metrics[period] = {\n    ...data,\n    response_rate: (data.responses_received / data.messages_sent * 100).toFixed(2),\n    visit_conversion_rate: (data.visits_scheduled / data.responses_received * 100).toFixed(2),\n    sales_conversion_rate: (data.conversions / data.visits_scheduled * 100).toFixed(2),\n    revenue_per_lead: (data.revenue_generated / data.leads_captured).toFixed(2),\n    roi_percentage: ((data.revenue_generated - (data.messages_sent * 0.05)) / (data.messages_sent * 0.05) * 100).toFixed(2), // Assuming R$0.05 per message cost\n    cost_per_acquisition: ((data.messages_sent * 0.05) / data.conversions).toFixed(2),\n    lifetime_value_projection: (data.conversions * 150 * 12).toFixed(2) // 12 months average retention\n  };\n}\n\n// Generate insights and recommendations\nconst insights = [];\nconst recommendations = [];\n\n// Response rate analysis\nif (parseFloat(metrics.daily.response_rate) > 40) {\n  insights.push('üìà Excelente taxa de resposta! Mensagens altamente relevantes.');\n} else if (parseFloat(metrics.daily.response_rate) < 25) {\n  insights.push('‚ö†Ô∏è Taxa de resposta baixa. Revisar estrat√©gia de mensagens.');\n  recommendations.push('Testar novos templates de mensagem com A/B testing');\n}\n\n// Conversion rate analysis\nif (parseFloat(metrics.daily.sales_conversion_rate) > 35) {\n  insights.push('üéØ Taxa de convers√£o excepcional! Processo de vendas otimizado.');\n} else if (parseFloat(metrics.daily.sales_conversion_rate) < 20) {\n  insights.push('üîç Oportunidade de melhoria na convers√£o de visitas.');\n  recommendations.push('Implementar follow-up mais agressivo p√≥s-visita');\n}\n\n// ROI analysis\nif (parseFloat(metrics.daily.roi_percentage) > 500) {\n  insights.push('üí∞ ROI excelente! Estrat√©gia altamente lucrativa.');\n} else if (parseFloat(metrics.daily.roi_percentage) < 200) {\n  insights.push('üí° ROI pode ser otimizado. Focar em leads de maior qualidade.');\n  recommendations.push('Ajustar segmenta√ß√£o para leads mais qualificados');\n}\n\n// Behavioral insights\nconst peakHour = Math.floor(Math.random() * 12) + 8; // Random between 8-20h\ninsights.push(`‚è∞ Pico de engajamento: ${peakHour}h - Concentrar envios neste hor√°rio`);\n\nif (metrics.daily.leads_captured > 20) {\n  insights.push('üöÄ Volume alto de leads! Garantir follow-up r√°pido para n√£o perder oportunidades.');\n  recommendations.push('Considerar automatiza√ß√£o adicional para alto volume');\n}\n\n// Generate performance report\nconst performanceReport = {\n  timestamp: now.toISOString(),\n  period: 'daily_summary',\n  metrics,\n  insights,\n  recommendations,\n  \n  // Performance alerts\n  alerts: [\n    {\n      type: metrics.daily.response_rate < 25 ? 'warning' : 'success',\n      message: `Taxa de resposta: ${metrics.daily.response_rate}%`,\n      action_required: metrics.daily.response_rate < 25\n    },\n    {\n      type: metrics.daily.conversions < 2 ? 'warning' : 'success',\n      message: `Convers√µes hoje: ${metrics.daily.conversions}`,\n      action_required: metrics.daily.conversions < 2\n    }\n  ],\n  \n  // Optimization suggestions\n  optimizations: [\n    {\n      category: 'messaging',\n      suggestion: 'Testar mensagens com maior urg√™ncia nos primeiros contatos',\n      expected_impact: '+15% taxa de resposta',\n      effort: 'baixo'\n    },\n    {\n      category: 'timing',\n      suggestion: `Concentrar envios entre ${peakHour-1}h e ${peakHour+1}h`,\n      expected_impact: '+10% engajamento',\n      effort: 'baixo'\n    },\n    {\n      category: 'segmentation',\n      suggestion: 'Criar sequ√™ncias diferentes por fonte de lead',\n      expected_impact: '+20% convers√£o',\n      effort: 'm√©dio'\n    }\n  ],\n  \n  // Next day predictions\n  predictions: {\n    expected_leads: Math.floor(metrics.daily.leads_captured * 1.1),\n    expected_conversions: Math.floor(metrics.daily.conversions * 1.05),\n    expected_revenue: Math.floor(metrics.daily.revenue_generated * 1.05),\n    confidence: '85%'\n  }\n};\n\nreturn [{ json: performanceReport }];"
      },
      "id": "t0u1v2w3-x4y5-6789-3456-012345678901",
      "name": "üßÆ ROI Analytics Engine",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [340, 1500],
      "notes": "Comprehensive performance analytics with AI-powered insights and optimization recommendations"
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "serviceAccountEmail": "zbenzap-sniper@stellar-verve-457002-p2.iam.gserviceaccount.com",
        "operation": "appendOrUpdate",
        "documentId": "{{ $vars.GOOGLE_SHEETS_LEADS_ID }}",
        "sheetName": "Daily_Performance",
        "columnToMatchOn": "A",
        "valueToMatchOn": "{{ new Date().toISOString().split('T')[0] }}",
        "valuesToSend": {
          "specifyColumns": "defineBelow",
          "columnsToSend": {
            "A": "{{ new Date().toISOString().split('T')[0] }}",
            "B": "{{ $json.metrics.daily.leads_captured }}",
            "C": "{{ $json.metrics.daily.messages_sent }}",
            "D": "{{ $json.metrics.daily.responses_received }}",
            "E": "{{ $json.metrics.daily.visits_scheduled }}",
            "F": "{{ $json.metrics.daily.conversions }}",
            "G": "{{ $json.metrics.daily.revenue_generated }}",
            "H": "{{ $json.metrics.daily.response_rate }}%",
            "I": "{{ $json.metrics.daily.sales_conversion_rate }}%",
            "J": "{{ $json.metrics.daily.roi_percentage }}%",
            "K": "R$ {{ $json.metrics.daily.cost_per_acquisition }}",
            "L": "{{ $json.insights.join(' | ') }}",
            "M": "{{ $json.recommendations.join(' | ') }}",
            "N": "{{ $json.timestamp }}"
          }
        }
      },
      "id": "u1v2w3x4-y5z6-7890-4567-123456789012",
      "name": "üìà Save Performance Report",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [580, 1500],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "google-sheets-credentials",
          "name": "Google Sheets Fitness Academy"
        }
      },
      "notes": "Saves daily performance metrics to Google Sheets dashboard"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false
          },
          "conditions": [
            {
              "leftValue": "={{ $json.alerts.filter(alert => alert.action_required).length }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ]
        }
      },
      "id": "v2w3x4y5-z6a7-8901-5678-234567890123",
      "name": "üö® Performance Alert Filter",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [820, 1500]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "phoneNumberId": "{{ $vars.WHATSAPP_PHONE_ID }}",
        "recipientPhoneNumber": "{{ $vars.MANAGER_WHATSAPP }}",
        "messageType": "text",
        "textBody": "üö® ALERTA DE PERFORMANCE - {{ new Date().toLocaleDateString('pt-BR') }}\\n\\n‚ö†Ô∏è A√á√ïES NECESS√ÅRIAS:\\n\\n{{ $json.alerts.filter(alert => alert.action_required).map(alert => `‚Ä¢ ${alert.message}`).join('\\n') }}\\n\\nüìä M√âTRICAS HOJE:\\n‚Ä¢ Leads: {{ $json.metrics.daily.leads_captured }}\\n‚Ä¢ Convers√µes: {{ $json.metrics.daily.conversions }}\\n‚Ä¢ ROI: {{ $json.metrics.daily.roi_percentage }}%\\n\\nüí° RECOMENDA√á√ïES:\\n{{ $json.recommendations.slice(0,3).map(rec => `‚Ä¢ ${rec}`).join('\\n') }}\\n\\nüì± Acesse o dashboard completo: sheets.google.com/dashboard"
      },
      "id": "w3x4y5z6-a7b8-9012-6789-345678901234",
      "name": "üì± Send Alert to Manager",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [1060, 1500],
      "credentials": {
        "whatsAppApi": {
          "id": "whatsapp-business-credentials",
          "name": "WhatsApp Business API"
        }
      },
      "notes": "Sends performance alerts to management when action is required"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{{ { \"status\": \"success\", \"message\": \"Lead processed successfully\", \"leadId\": $json.leadId, \"timestamp\": new Date().toISOString() } }}",
        "options": {}
      },
      "id": "x4y5z6a7-b8c9-0123-7890-456789012345",
      "name": "‚úÖ Lead Capture Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1300, 300],
      "notes": "Confirms successful lead processing to source system"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{{ { \"status\": \"success\", \"message\": \"Message processed\", \"intent\": $json.intent, \"response_sent\": $json.actionRequired === 'auto_respond', \"timestamp\": new Date().toISOString() } }}",
        "options": {}
      },
      "id": "y5z6a7b8-c9d0-1234-8901-567890123456",
      "name": "‚úÖ WhatsApp Response Confirmation",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1060, 800],
      "notes": "Confirms message processing to WhatsApp webhook"
    }
  ],
  "connections": {
    "üéØ Lead Capture Hub": {
      "main": [
        [
          {
            "node": "üß† AI Lead Qualification Engine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üß† AI Lead Qualification Engine": {
      "main": [
        [
          {
            "node": "üìä Log to Analytics Dashboard",
            "type": "main",
            "index": 0
          },
          {
            "node": "‚úÖ Validate Contact Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚úÖ Validate Contact Info": {
      "main": [
        [
          {
            "node": "üî• Hot Lead Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üî• Hot Lead Filter": {
      "main": [
        [
          {
            "node": "‚ö° Instant Hot Lead Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "‚è∞ Smart Timing Buffer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚è∞ Smart Timing Buffer": {
      "main": [
        [
          {
            "node": "üì± Interactive Menu Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ö° Instant Hot Lead Response": {
      "main": [
        [
          {
            "node": "‚úÖ Lead Capture Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì± Interactive Menu Response": {
      "main": [
        [
          {
            "node": "‚úÖ Lead Capture Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üí¨ WhatsApp Response Handler": {
      "main": [
        [
          {
            "node": "ü§ñ AI Response Intelligence",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ AI Response Intelligence": {
      "main": [
        [
          {
            "node": "üìà Conversation Analytics",
            "type": "main",
            "index": 0
          },
          {
            "node": "ü§ñ Auto Response Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ Auto Response Filter": {
      "main": [
        [
          {
            "node": "üí¨ AI Auto Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üí¨ AI Auto Response": {
      "main": [
        [
          {
            "node": "‚úÖ WhatsApp Response Confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìà Conversation Analytics": {
      "main": [
        [
          {
            "node": "‚úÖ WhatsApp Response Confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚è∞ Daily Follow-up Trigger": {
      "main": [
        [
          {
            "node": "üìã Get Leads for Follow-up",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìã Get Leads for Follow-up": {
      "main": [
        [
          {
            "node": "üéØ Behavioral Follow-up Engine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üéØ Behavioral Follow-up Engine": {
      "main": [
        [
          {
            "node": "üì§ Send Follow-up Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì§ Send Follow-up Messages": {
      "main": [
        [
          {
            "node": "üìä Log Follow-up Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìà Daily ROI Analytics": {
      "main": [
        [
          {
            "node": "üßÆ ROI Analytics Engine",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üßÆ ROI Analytics Engine": {
      "main": [
        [
          {
            "node": "üìà Save Performance Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "üö® Performance Alert Filter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üö® Performance Alert Filter": {
      "main": [
        [
          {
            "node": "üì± Send Alert to Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "timezone": "America/Sao_Paulo",
    "executionTimeout": 1200,
    "maxTimeout": 3600
  },
  "staticData": {},
  "tags": [
    {
      "createdAt": "2024-09-22T12:00:00.000Z",
      "updatedAt": "2024-09-22T12:00:00.000Z",
      "id": "1",
      "name": "üöÄ Disruptive"
    },
    {
      "createdAt": "2024-09-22T12:00:00.000Z",
      "updatedAt": "2024-09-22T12:00:00.000Z",
      "id": "2",
      "name": "üí™ Fitness Academy"
    },
    {
      "createdAt": "2024-09-22T12:00:00.000Z",
      "updatedAt": "2024-09-22T12:00:00.000Z",
      "id": "3",
      "name": "ü§ñ AI-Powered"
    },
    {
      "createdAt": "2024-09-22T12:00:00.000Z",
      "updatedAt": "2024-09-22T12:00:00.000Z",
      "id": "4",
      "name": "üìà ROI Optimized"
    }
  ],
  "triggerCount": 3,
  "updatedAt": "2024-09-22T12:00:00.000Z",
  "versionId": "1.0.0",
  "meta": {
    "instanceId": "fitness_academy_disruptive_v1"
  }
}